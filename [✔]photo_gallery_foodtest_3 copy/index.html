<!DOCTYPE html>
<!-- saved from url=(0037)http://pmneed.com/foodtest/card2.html -->
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <title>一个测试，想吃吗</title>

        <meta name="keywords" content="">
        <meta name="description" content="">

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <meta name="x5-orientation" content="portrait">
        <meta name="screen-orientation" content="portrait">
        <meta name="format-detection" content="telephone=no">

        <!--UC强制全屏-->
        <meta name="x5-fullscreen" content="true">
        <!--QQ强制竖屏-->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <meta name="author" content="">

        <link rel="stylesheet" type="text/css" href="reset.css">

        <style>

            body {
                font-size: 70%;
                font-family:"Microsoft YaHei",Arial;
                overflow-x:hidden;
                background-color: #FAFAFA;
            }

            #container {
                overflow:hidden;
                position: absolute;
                -webkit-transition: all .62s;
            }

            li, .stack_item {
                background-color: white;
                padding-bottom: 10px;
                box-sizing: border-box;

                position: absolute;
                max-height: 660px;

                margin-left: 3%;
                margin-top: -18px;

                overflow: hidden;
                border: 1px solid #E5E5E5;
                border-radius: 1em;
                /*position: absolute;*/

                /*-webkit-perspective: 800px;*/
                /*-webkit-transform-style: preserve-3d;*/
                -webkit-transition: all .62s;
                -webkit-transition-timing-function: ease-in-out;
                -webkit-backface-visibility: hidden;

            }

            img {
                border-top-left-radius: 1em;
                border-top-right-radius: 1em;
                display: block;
                /*width: 100%;*/
                /*height: 100%;*/
                max-height: 360px;
                margin-top: -20px;

                overflow: hidden;
            }

            .photo {
                min-width: 240px;
            }

            h1 {
                font-size: 2em;
                line-height: 1.4em;
                font-weight: bold;
                margin-left: 10%;
                margin-top: 4%;
            }

            h2 {
                font-size: 1.5em;
                color: #979797;
                line-height: 2em;
                font-weight: 400;
                margin-left: 10%;
            }

            .controls {
                margin: 0 auto;
            }

            .button_area {
                width: 49%;
                float: left;
                text-align: center;
            }

            .button_1, .button_2 {
                margin-left: 30%;
                margin-bottom: 1em;
                margin-top: 2em;
                width: 40%;
                opacity: 0.4;
                filter:Alpha(opacity=40); /* IE8 以及更早的浏览器 */
            }

            .dislikeBtnPressed {
                opacity: 1;
                filter:Alpha(opacity=100); /* IE8 以及更早的浏览器 */
                -webkit-transition: all .1s;
                -webkit-transform: scale(1.2);
            }

            .likeBtnPressed {
                opacity: 1;
                filter:Alpha(opacity=100); /* IE8 以及更早的浏览器 */
                -webkit-transition: all .1s;
                -webkit-transform: scale(1.2);
            }

            .text-hidden {
                font-size: 1.4em;
                line-height: 2em;
                display: none;
            }

            .dislike-button {
                color: #D7DBDC;
            }

            .like-button {
                color: #F1E2BC;
            }

            .prev_item {
                /*-webkit-transform: translate3d(-103%,0,0);*/
                -webkit-transform: translate(-100%,0%);
                -webkit-transition: all .62s;
                -webkit-transition-timing-function: ease-in-out;
                -webkit-backface-visibility: hidden;
            }

            .current_item {
                /*-webkit-transform: translate3d(0,0,0);*/
                -webkit-transform: translate(0%,0%);
                -webkit-transition: all .8s;
                -webkit-transition-timing-function: ease-in-out;
                -webkit-backface-visibility: hidden;
                /*z-index: 999;*/
            }

            .next_item {
                /*-webkit-transform: translate3d(103%,0,0);*/
                display: none;
                -webkit-transform: translate(100%, 0%);
                -webkit-transition: all .62s;
                -webkit-transition-timing-function: ease-in-out;
                -webkit-backface-visibility: hidden;
            }

            .like {
                /* 左滑时往左边偏移的角度，透明度为0 */
                -webkit-transition: all .62s;
                -webkit-transform: rotateZ(45deg);
                opacity: 0;
                filter:Alpha(opacity=0); /* IE8 以及更早的浏览器 */
                -webkit-backface-visibility: hidden;
            }

            .dislike {
                /* 左滑时往左边偏移的角度，透明度为0 */
                -webkit-transition: all .62s;
                -webkit-transform: rotateZ(-30deg);
                opacity: 0;
                filter:Alpha(opacity=0); /* IE8 以及更早的浏览器 */
                -webkit-backface-visibility: hidden;
            }

            #detail {
                display: none;
                background-color: white;
                height: 100%;
                width: 100%;
                margin: 0;
                padding: 0;
                /*-webkit-transition: all .62s;*/
                -webkit-backface-visibility: hidden;

                /* js中完成的初始化 */
                /*position: absolute;*/
                /*top: 0;*/
                /*left: 0;*/
            }

            .bigPhoto_area {
                width: 100%;
                height: 340px;     /* 给photo_area一个高度 */
                line-height: 100%;
                position: relative;
            }

            .bigPhoto {
                /*-webkit-transition: all .62s;*/
                /*-webkit-transition-timing-function: ease-in-out;*/
                /*-webkit-transform: scale(1);*/
                width: 100%;
                position: absolute;
                top: 0;
                left: 0;
                z-index: 1;
                border-radius: 0;
            }

            .button_3 {
                position: absolute;
                top: 30px;
                left: 10px;
                z-index: 20;
                width: 44px;
                height: 44px;
            }

            .bigPhoto_area, .detail_text {
                display: block;
            }

            /* margin = margin A + margin B */
            .tags_area {
                margin-top: 1em;
                margin-left: 6%;    /* margin A */
            }

            .tags {
                border: 1px solid #48b8db;
                border-radius: 12px;
                font-size: 1em;
                line-height: 1.4em;
                font-weight: bold;
                margin-left: 4%;    /* margin B */
                margin-top: 4%;
                padding: 0.5em 1em;

                color: #48b8db;
            }


        </style>

    </head>
    <body>

    <script type="text/javascript">

        // 改进点
        // 1. 使用 position absolute 做 很耗内存, -webkit-transform 好一些


        // 元数据
        var data = [
            { img : "img_compress/f1@2x.png", caption : "草莓拿破仑", desc : "酥脆与柔软可以兼得", tags : ["高颜值下午茶", "入口即化"] },
            { img : "img_compress/f2@2x.png", caption : "水果冻膏", desc : "清凉一夏，就靠你了", tags : ["高颜值下午茶"] },
            { img : "img_compress/f3@2x.png", caption : "公主的仲夏夜之梦", desc : "穿好水晶鞋，一起来梦游仙境", tags : ["高颜值下午茶"] },
            { img : "img_compress/f4@2x.png", caption : "澳洲M2慢烤牛排", desc : "低温慢烤，牛排更加柔软多汁", tags : ["肉食主义"] },
            { img : "img_compress/f5@2x.png", caption : "泡芙塔巧克力蛋糕", desc : "泡芙留下，其余的都给你", tags : ["高颜值下午茶"] },
            { img : "img_compress/f6@2x.jpg", caption : "小笼包", desc : "等你来添加故事哟", tags : ["精选上海小吃"] },
            { img : "img_compress/f7@2x.jpg", caption : "培根火锅", desc : "等你来添加故事哟", tags : ["犒劳自己的晚餐"] },
            { img : "img_compress/f8@2x.jpg", caption : "摩卡", desc : "等你来添加故事哟", tags : ["高颜值下午茶"] },
            { img : "img_compress/f9@2x.jpg", caption : "酸奶慕斯", desc : "等你来添加故事哟", tags : ["高颜值下午茶"] }
        ];

        // 拿到屏幕的长和宽 有浏览器兼容问题
        var screenHeight = (document.body.clientHeight === 0) ? document.documentElement.clientHeight : document.body.clientHeight;
        var screenWidth = (document.body.clientWidth === 0) ? document.documentElement.clientWidth : document.body.clientWidth;
        // console.log(screenHeight, screenWidth);


        /****************************************** 1. 列表页 ******************************************/

        // 展示列表页的函数，可以传入从哪个列表页进入的参数
        function showCardList(cardIndex){

            // 为了知道从哪个页面返回的，如果没有传参数(不知道哪一页返回的话)，默认为0
            if(!cardIndex || cardIndex === null){
                cardIndex = 0;
            }
            // 获取 container DOM, 如果被清除赋值为空
            var myCards = document.getElementById('container') || '';
            //console.log(myCards);

            // 如果 myCards为空，初始化
            function initMyCards(){
                // 从详情页返回的话，列表页是空的，需要重新创建 ul#container 母元素插入 body[0]
                // <body>
                //  <ul id=#detail>
                //      ...
                //  </ul>
                //  <script>
                //      ...
                //  <\/script>
                // </body>
                if( myCards === '' ){
                    // 创建 ul#container
                    var ulEle = document.createElement('ul');
                    ulEle.id = 'container';

                    // 插入body[0]
                    document.body.insertBefore(ulEle,document.body.childNodes[0]);
                    myCards = document.getElementById('container');
                    //console.log(myCards);
                }
            }

            // 初始化 卡片列表页 html
            function addCards(){
                // myCards.innerHTML 可能为空(因为被清除了) 所以用模板赋值
                var template = myCards.innerHTML ||
                                '<li class="stack_item next_item" id="card_{{index}}">\
                                    <div class="picAndText">\
                                        <img class="photo" src="{{img}}" alt="food pics">\
                                        <h1>{{caption}}</h1>\
                                        <h2>{{desc}}</h2>\
                                    </div>\
                                    <div class="controls">\
                                        <div class="button_area button_dislike" data-stack="">\
                                            <img class="button_1" src="img_compress/dislike@2x.png" alt="dislike">\
                                        </div>\
                                        <div class="button_area button_like" data-stack="">\
                                            <img class="button_2" src="img_compress/like@2x.png" alt="like">\
                                        </div>\
                                    </div>\
                                </li>';
                var html = [];

                // 内容替换
                for(var i = 0 ; i < data.length; i++){
                    var _html = template
                        .replace('{{index}}', i)
                        .replace('{{img}}', data[i].img)
                        .replace('{{caption}}', data[i].caption)
                        .replace('{{desc}}', data[i].desc);

                    html.push(_html);
                }
                //console.log(html);

                // html内容重新插入
                myCards.innerHTML = html.join('');
                //console.log(myCards);


            }

            // 排序函数
            function sort(){
                // 把照片横向排列
                for(var i = 0 ; i < cards.length; i++){

                    // 初始卡片位置，高度=屏幕高度，X = 0，1W，2W，3W ... Y = -1/3H
                    cards[i].style.height = screenHeight;
                    cards[i].style.left = screenWidth*i + 'px';
                    cards[i].style.display = "block";
                    cards[i].style.top = -screenHeight/3 + 'px';

                }

            }

            // 不知道要不要的一段代码
//            if( localStorage.pageId ){
//                cardIndex = parseInt(localStorage.pageId);
//            }

            // 如果是从详情页返回
            function ifBackFromDetailPage(){
                // 对于要返回的这张区别对待
                //console.log(cards[cardIndex]);
                // 赋予 .current_item 样式
                cards[cardIndex].className = cards[cardIndex].className.replace(/\s*next_item/,' current_item');
                // 赋予正常 Y 值
                cards[cardIndex].style.top = '20px';
                // console.log(cards[i].style.left, cards[i].style.top);
                // 赋予正常 X 值
                cards[cardIndex].style.left = '0px';

                // 返回后的页面之前的卡片位置 X 重置
                for(var k = 0; k < cardIndex; k++){
                    cards[k].className = cards[k].className.replace(/\s*next_item/,' prev_item');
                    cards[k].style.left = screenWidth*(k-cardIndex) + 'px';
                }

                // 返回后的页面之后的卡片位置 X 重置
                for(var m = cardIndex; m < cards.length; m++){
                    cards[m].style.left = screenWidth*(m-cardIndex) + 'px';
                }

                // 调试用
                for(var i = 0; i < cards.length; i++){
                    console.log(cards[i].style.left);
                }
            }

            // 改变一些元素的大小
            // container 自适应屏幕大小
            function adjustToScreenSize(){
                myCards.style.width = screenWidth + 'px';
                myCards.style.height = screenHeight + 'px';
                //console.log(myCards.style.width);
            }

            // 缩小 li容器和img 大小
            function scaleOfCards(scale){

                var stackItem = document.querySelectorAll('.stack_item');
                var imgs = document.querySelectorAll('.photo');
                var numOfCards = stackItem.length;
                //console.log( numOfCards );
                for(var i = 0; i < numOfCards; i++){
                    // 缩小li0.94倍
                    stackItem[i].style.width = parseInt(myCards.style.width.replace('px',''))*scale + 'px';
                    stackItem[i].style.height = parseInt(myCards.style.height.replace('px',''))*scale + 'px';
                    //console.log(myCards.style.width);
                    // 缩小img0.94倍
                    imgs[i].style.width = parseInt(myCards.style.width.replace('px',''))*scale + 'px';
                    imgs[i].style.height = parseInt(myCards.style.height.replace('px',''))*scale + 'px';
                    //console.log( imgs[i].style.width );
                }
            }

            // 1. 初始化 div#container
            initMyCards();

            // 2. 添加 卡片列表页 html 内容
            addCards();
            // 添加html内容后获取所有的卡片 和 addCards() 依赖关系
            var cards = document.querySelectorAll('.stack_item');
            // console.log(cards.length);

            // 3. 给卡片初始化排序
            sort();

            // 4. CSS苦手，用js适应屏幕大小
            adjustToScreenSize();

            // 5. 缩小 li容器和img 大小
            var scale = 0.94;
            scaleOfCards(scale);

            // 6. 如果是从详情页返回
            ifBackFromDetailPage();

            // 列表页用户操作、事件监听
            // get all stack item
            // var cards = document.querySelectorAll('.stack_item');
            // console.log(cards);
            // console.log(cards.length);

            // 获取点击区域
            var dislikeBtn = document.querySelectorAll('.button_1');
            //console.log(dislikeBtn);
            var likeBtn = document.querySelectorAll('.button_2');
            var picAndText = document.querySelectorAll('.picAndText');
            //console.log(picAndText);

            // 在父级元素上添加点击事件 ** 未来可以把按钮提出来，减少事件绑定 **
            for(var j = 0; j < dislikeBtn.length; j++){
                dislikeBtn[j].onclick = doDislikeAction;
                //console.log(dislikeBtn[j]);
                likeBtn[j].onclick = doLikeAction;
                picAndText[j].onclick = goToFoodDetailPage;
                //console.log(picAndText[j]);
            }

        }

        showCardList();

        /****************************************** 2. 去详情页 ******************************************/

        function goToFoodDetailPage(e){
            //console.log("DetailPage");

            // 1. 获取当前点击的元素
            var ele = e.target;
            var eleName = ele.localName;
            var eleId = ele.id;
            var eleIndex = eleId.slice(5);
            //console.log(ele, eleName, eleId, eleIndex);

            // 2. 当点击的元素不是li, 向上冒泡直到li
            while( true ){
                // 如果是 li 结束
                if( eleName === 'li' ){ break; }
                // 向上冒泡，拿到爸爸元素
                ele = ele.parentNode;
                eleName = ele.localName;
                eleId = ele.id;
                eleIndex = parseInt(eleId.slice(5));
                //console.log(ele, eleName, eleId, eleIndex);
            }

            // 存储下是第几个商品进入的详情页
            localStorage.pageId = eleIndex;
            //console.log(localStorage.pageId);

            // 3. 清空所有列表页html
            var cardList = document.querySelector('#container');
            document.querySelector('body').removeChild(cardList);

            // 4. 创建详情页 div#detail
            var detailPage = document.querySelector('#detail') || '';

            if( detailPage === '' ){
                var divEle = document.createElement('div');
                divEle.id = 'detail';

                var scriptEle = document.querySelector('script');

                document.body.insertBefore(divEle,document.body.childNodes[0]);
                detailPage = document.getElementById('detail');

            }

            var template = '<div class="bigPhoto_area">\
                                <img class="button_3" src="img_compress/back2@2x.png" alt="dislike">\
                                <img class="bigPhoto" src="{{img}}" alt="big food pic">\
                            </div>\
                            <h1 class="detail_text">{{caption}}</h1>\
                            <h2 class="detail_text">{{desc}}</h2>\
                            <div class="tags_area"></div>\
                            <div class="controls">\
                                <div class="button_area button_dislike">\
                                    <img class="button_1" src="img_compress/dislike@2x.png" alt="dislike">\
                                </div>\
                                <div class="button_area button_like">\
                                    <img class="button_2" src="img_compress/like@2x.png" alt="like">\
                                </div>\
                            </div>';

            var html = [];
            //console.log(eleIndex);

            var _html = template
                .replace('{{img}}', data[eleIndex].img)
                .replace('{{caption}}', data[eleIndex].caption)
                .replace('{{desc}}', data[eleIndex].desc);

            html.push(_html);
            detailPage.innerHTML = html;

            // 初始化位置后才可以利用位置值移动 CSS 没做到 没有这3个值，后面的动画无法完成位移
            detailPage.style.position = 'absolute';
            detailPage.style.left = '0px';
            detailPage.style.top = '0px';
            // 给内页一个高度
            detailPage.style.height = screenHeight + 'px';
            //console.log(detailPage.style.height);
            // 把隐藏的这段html变为可视
            detailPage.style.display = "block";
            detailPage.style['-webkit-transition'] = 'all .6s linear';


            // 标签内容显示
            var tags = document.querySelector('.tags_area');
            for(var i = 0; i < data[eleIndex]['tags'].length; i++){
                var spanEle = document.createElement('span');
                spanEle.textContent += data[eleIndex]['tags'][i];
                spanEle.className += 'tags';
                tags.appendChild(spanEle);
            }



            // 返回按钮与事件绑定
            var backBtn = document.querySelector('.button_3');
            //console.log(backBtn);
            backBtn.onclick = goBackToFoodCards;

            // 喜欢与不喜欢按钮与事件绑定
            var dislikeBtn = document.querySelector('.button_1');
            //console.log(dislikeBtn);
            var likeBtn = document.querySelector('.button_2');
            dislikeBtn.onclick = doDislikeActionOnDetailPage;
            likeBtn.onclick = doLikeActionOnDetailPage;

        }

        /****************************************** 3. 从详情页回到列表页 ******************************************/

        function goBackToFoodCards(e){
            //console.log(e);
            //console.log("goBackToFoodCards");
            //console.log(eleIndex);

            // 1. 清空详情页
            var cardDetail = document.querySelector('#detail');
            document.querySelector('body').removeChild(cardDetail);

            // 2. 加载列表页
            showCardList(localStorage.pageId);
        }

        function doLikeActionOnDetailPage(e) {

            // 1. 是从序号多少的食物点进来的
            var eleIndex = parseInt(localStorage.pageId);
            console.log(eleIndex);

            // 2. 如果到底了
            if( eleIndex === (data.length - 1) ) {
                alert("到底啦～");
            }

            // 3. 如果没到底
            // 先做 like 的动画
            if( eleIndex < data.length - 1) {

                // 选中整个详情页
                var chosenEle = document.getElementById('detail');
                //console.log(chosenEle);
                //chosenEle.style.display = "none";

                function animate(){

                    // 添加 .like .prev_item 样式
                    chosenEle.className += ' like';
                    chosenEle.className += ' prev_item';
                    //console.log(chosenEle.className);

                    // btn变色
                    //console.log(document.querySelectorAll('.button_1')[eleIndex]);
                    document.querySelector('.button_2').className += ' likeBtnPressed';

                    // 向左移动一个屏幕 前提依赖是设置了 position: absolute, top, left等值
                    //console.log(chosenEle.style.left);
                    chosenEle.style.left = (parseInt(chosenEle.style.left) + screenWidth) + 'px';
                    //console.log(chosenEle.style.left);

                    // Y轴方向下移100像素
                    chosenEle.style.top = (parseInt(chosenEle.style.top) + 100) + 'px';
                    //console.log(chosenEle.style.left, chosenEle.style.top);

                }

                function animateThen(callback){

                    if (typeof callback === "function"){
                        // 0.6秒后再回到列表页
                        setTimeout(callback, 500);
                    }
                }

                // 动画结束后回到列表页
                animate();
                // 4. 回到上一页
                animateThen(goBackToNextFoodCards);

            }

        }

        function doDislikeActionOnDetailPage(e) {

            // 1. 是从序号多少的食物点进来的
            var eleIndex = parseInt(localStorage.pageId);
            console.log(eleIndex);

            // 2. 如果到底了
            if( eleIndex === (data.length - 1) ) {
                alert("到底啦～");
            }

            // 3. 如果没到底
            // 先做 dislike 的动画
            if( eleIndex < data.length - 1) {

                // 选中整个详情页
                var chosenEle = document.getElementById('detail');
                //console.log(chosenEle);
                //chosenEle.style.display = "none";

                function animate(){

                    // 添加 .dislike样式
                    chosenEle.className += ' dislike';
                    chosenEle.className += ' prev_item';
                    //console.log(chosenEle.className);

                    // btn变色
                    //console.log(document.querySelectorAll('.button_1')[eleIndex]);
                    document.querySelector('.button_1').className += ' dislikeBtnPressed';

                    // Y轴方向下移100像素
                    chosenEle.style.top = (parseInt(chosenEle.style.top) + 100) + 'px';
                    //console.log(chosenEle.style.top);

                    // 向左移动一个屏幕 不知道为何失效
                    //console.log(chosenEle.style.left);
                    chosenEle.style.left = (parseInt(chosenEle.style.left) - screenWidth) + 'px';
                    //console.log(chosenEle.style.left);

                }


                function animateThen(callback){

                    if (typeof callback === "function"){
                        // 0.6秒后再回到列表页
                        setTimeout(callback, 600);
                    }
                }

                // 动画结束后回到列表页
                animate();

                // 4. 回到上一页
                animateThen(goBackToNextFoodCards);

            }

        }

        function goBackToNextFoodCards(e){
            //console.log(e);
            //console.log("goBackToFoodCards");
            //console.log(eleIndex);

            // 清空本页
            var cardDetail = document.querySelector('#detail');
            document.querySelector('body').removeChild(cardDetail);

            // 加载列表页下一张
            showCardList(parseInt(localStorage.pageId)+1);
        }

        function doDislikeAction(e) {

            // 1. 获取当前点击的元素
            var ele = e.target;
            var eleName = ele.localName;
            var eleId = ele.id;
            var eleIndex = eleId.slice(5);
            //console.log(ele, eleName, eleId, eleIndex);

            // 2. 当点击的元素不是li, 向上冒泡直到li
            while( true ){
                // 如果是 li 结束
                if( eleName === 'li' ){ break; }

                // 向上冒泡，拿到爸爸元素
                ele = ele.parentNode;
                eleName = ele.localName;
                eleId = ele.id;
                eleIndex = parseInt(eleId.slice(5));
                //console.log(ele, eleName, eleId, eleIndex);
            }

            var cards = document.querySelectorAll('.stack_item');

            // 3. 如果到底了
            if( eleIndex === (cards.length - 1) ) {
                alert("到底啦～");
            }

            // 4. 如果没到底，
            if( eleIndex < cards.length - 1){

                // 1. 当前的元素被点击后变成过去的元素
                var chosenEle = document.getElementById(eleId);
                chosenEle.className = chosenEle.className.replace(/\s*current_item/,' prev_item');
                // 添加 .dislike样式
                chosenEle.className += ' dislike';
                // Y轴方向下移100像素
                chosenEle.style.top = (parseInt(chosenEle.style.top) + 100) + 'px';

                // 2. 下一个元素变成当前元素
                var nextId = 'card_' + ( parseInt(eleIndex) + 1 );
                var nextEle = document.getElementById(nextId);

                nextEle.className = nextEle.className.replace(/\s*next_item/,' current_item');
                // 调整下个元素的高度
                nextEle.style.top = '20px';

                // 3. 所有元素的位置调整
                for(var i = 0; i < cards.length; i++){
                    cards[i].style.left = (parseInt(cards[i].style.left) - screenWidth) + 'px';
                    //console.log(cards[i].style.left);
                }

                // 4. btn变色
                //console.log(document.querySelectorAll('.button_1')[eleIndex]);
                document.querySelectorAll('.button_1')[eleIndex].className += ' dislikeBtnPressed';
            }


        }

        function doLikeAction(e) {
            // 1. 获取当前点击的元素
            var ele = e.target;
            var eleName = ele.localName;
            var eleId = ele.id;
            var eleIndex = eleId.slice(5);
            //console.log(ele, eleName, eleId, eleIndex);

            // 2. 当点击的元素不是li, 向上冒泡直到li
            while( true ){
                // 如果是 li 结束
                if( eleName === 'li' ){ break; }

                // 向上冒泡，拿到爸爸元素
                ele = ele.parentNode;
                eleName = ele.localName;
                eleId = ele.id;
                eleIndex = parseInt(eleId.slice(5));
                //console.log(ele, eleName, eleId, eleIndex);
            }

            var cards = document.querySelectorAll('.stack_item');
            // 3. 如果到底了
            if( eleIndex === (cards.length - 1) ) {
                alert("木有更多啦～");
            }

            // 4. 如果没到底，
            if( eleIndex < cards.length - 1){

                // 1. 当前的元素被点击后变成过去的元素
                var chosenEle = document.getElementById(eleId);
                chosenEle.className = chosenEle.className.replace(/\s*current_item/,' prev_item');
                chosenEle.className += ' like';
                // Y轴方向下移100像素
                chosenEle.style.top = (parseInt(chosenEle.style.top) + 100) + 'px';

                // 2. 下一个元素变成当前元素
                var nextId = 'card_' + ( parseInt(eleIndex) + 1 );
                var nextEle = document.getElementById(nextId);
                nextEle.className = nextEle.className.replace(/\s*next_item/,' current_item');
                // 调整下个元素的高度
                nextEle.style.top = '20px';

                // 3. 所有元素的位置调整
                for(var i = 0; i < cards.length; i++){
                    if( i === eleIndex ){
                        cards[i].style.left = (parseInt(cards[i].style.left) + screenWidth) + 'px';
                    } else {
                        cards[i].style.left = (parseInt(cards[i].style.left) - screenWidth) + 'px';
                    }
                    //console.log(cards[i].style.left, cards[i].style.top);
                    //console.log(eleIndex, cards[i].style.left);
                }
                //console.log('\n');

                // 5. btn变色
                //console.log(document.querySelectorAll('.button_2')[eleIndex]);
                document.querySelectorAll('.button_2')[eleIndex].className += ' likeBtnPressed';

                function rePosition(){
                    for(var i = 0; i < cards.length; i++){
                        if( i === eleIndex ){
                            cards[i].style.left = -screenWidth + 'px';
                        } else if( i < eleIndex ) {
                            // 0  1  2  3  4  5
                            // 这段有点难算
                            cards[i].style.left = -(eleIndex-i+1)*screenWidth + 'px';
                        } else {
                            cards[i].style.left = (i-eleIndex-1)*screenWidth + 'px';
                        }
                        //console.log(cards[i].style.left, cards[i].style.top);
                        //console.log(eleIndex, cards[i].style.left);
                    }
                }

                function rePositionThen(callback){
                    if (typeof callback === "function"){
                        // 0.6秒后再回调
                        setTimeout(callback, 600);
                    }
                }

                // 动画完毕后，重新归位
                rePositionThen(rePosition);
            }
        }


    </script>

    </body>
</html>