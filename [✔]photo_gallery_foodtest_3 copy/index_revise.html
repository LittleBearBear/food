<!DOCTYPE html>
<!-- saved from url=(0037)http://pmneed.com/foodtest/card2.html -->
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <title>卡片美食</title>

        <meta name="keywords" content="">
        <meta name="description" content="">

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <meta name="x5-orientation" content="portrait">
        <meta name="screen-orientation" content="portrait">
        <meta name="format-detection" content="telephone=no">

        <!--UC强制全屏-->
        <meta name="x5-fullscreen" content="true">
        <!--QQ强制竖屏-->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <meta name="author" content="">

        <link rel="stylesheet" type="text/css" href="reset.css">

        <style>

            body {
                font-size: 70%;
                font-family:"Microsoft YaHei",Arial;
                overflow-x:hidden;
                background-color: #FAFAFA;
            }

            #container {
                overflow:hidden;
                position: absolute;
                -webkit-transition: all .62s;
            }

            li, .stack_item {
                background-color: white;
                padding-bottom: 10px;
                box-sizing: border-box;

                position: absolute;

                /* 水平居中用 scale = 0.94 */
                margin-left: 3%;

                /* 待定 */
                margin-top: -18px;

                overflow: hidden;
                border: 1px solid #E5E5E5;
                border-radius: 1em;

                /*-webkit-perspective: 800px;*/
                /*-webkit-transform-style: preserve-3d;*/
                -webkit-transition: all .62s;
                -webkit-transition-timing-function: ease-in-out;
                -webkit-backface-visibility: hidden;
            }

            img {
                /* 左右上角圆角 */
                border-top-left-radius: 1em;
                border-top-right-radius: 1em;
                display: block;

                /* 图片占据的最大高度 */
                max-height: 360px;
                /* 莫名奇妙的空白处理 */
                margin-top: -20px;

                overflow: hidden;
            }

            /* img.photo */
            .photo {
                /*min-width: 240px;*/
            }

            h1, h2 {
                margin-left: 5%;
            }

            h1 {
                font-size: 1.8em;
                line-height: 1.4em;
                font-weight: bold;
                margin-top: 4%;
            }

            h2 {
                font-size: 1.4em;
                line-height: 2em;
                font-weight: 400;

                color: #979797;
            }

            /* 按钮部分的位置、like、dislike动画 */
            .controls {
                margin: 0 auto;
            }

            .button_area {
                width: 49%;
                float: left;
                text-align: center;
            }

            .button_1, .button_2 {
                /* 水平居中 */
                width: 40%;
                margin-left: 30%;

                margin-bottom: 1em;
                margin-top: 2em;

                opacity: 0.4;
                filter:Alpha(opacity=40); /* IE8 以及更早的浏览器 */
            }

            .dislike-button {
                color: #D7DBDC;
            }

            .like-button {
                color: #F1E2BC;
            }

            .dislikeBtnPressed, .likeBtnPressed {
                opacity: 1;
                filter:Alpha(opacity=100); /* IE8 以及更早的浏览器 */

                -webkit-transition: all .2s;
                -webkit-transform: scale(1.36);
            }

            /*!* 嫌弃，喜欢暂时去掉了用不到了 *!*/
            /*.text-hidden {*/
                /*font-size: 1.4em;*/
                /*line-height: 2em;*/
                /*display: none;*/
            /*}*/

            /* 左、中、右归位 */
            .prev_item, .current_item, .next_item {
                -webkit-transition-timing-function: ease-in-out;
                -webkit-backface-visibility: hidden;
            }

            .prev_item {
                -webkit-transform: translate(-100%,0%);
                -webkit-transition: all .62s;
            }

            .current_item {
                -webkit-transform: translate(0%,0%);
                -webkit-transition: all .8s;
            }

            .next_item {
                -webkit-transform: translate(100%, 0%);
                -webkit-transition: all .62s;
            }

            /* 点击后左右消失 */
            .like, .dislike {
                opacity: 0;
                filter:Alpha(opacity=0); /* IE8 以及更早的浏览器 */
                -webkit-backface-visibility: hidden;
            }

            .like {
                /* 左滑时往左边偏移的角度，透明度为0 */
                -webkit-transition: all .62s;
                -webkit-transform: rotateZ(45deg);
            }

            .dislike {
                /* 左滑时往左边偏移的角度，透明度为0 */
                -webkit-transition: all .62s;
                -webkit-transform: rotateZ(-30deg);
            }

            /* 详情页 */
            #detail {
                display: none;
                background-color: white;
                height: 100%;
                width: 100%;
                margin: 0;
                padding: 0;
                /*-webkit-transition: all .62s;*/
                -webkit-backface-visibility: hidden;

                /* js中完成的初始化 */
                /*position: absolute;*/
                /*top: 0;*/
                /*left: 0;*/

                -webkit-transition: all .62s;
                -webkit-transition-timing-function: ease-in-out;
                -webkit-backface-visibility: hidden;
            }

            .bigPhoto_area {
                width: 100%;
                height: 340px;     /* 给photo_area一个高度 */
                /*line-height: 100%;*/
                position: relative;
            }

            .bigPhoto {
                width: 100%;
                position: absolute;
                top: 0;
                left: 0;
                z-index: 1;
                /* 清空之间的 border-radius */
                border-radius: 0;
            }

            /* 返回按钮 */
            .button_3 {
                position: absolute;
                top: 30px;
                left: 10px;
                z-index: 20;
                width: 44px;
                height: 44px;
            }

            .bigPhoto_area, .detail_text {
                display: block;
            }

            /* margin : 5% = marginA : 3% + marginB : 2%*/
            .tags_area {
                margin-top: 1em;
                margin-left: 3%;    /* margin A */
            }

            .tags {
                border: 1px solid #48b8db;
                border-radius: 12px;
                font-size: 1em;
                line-height: 1.4em;
                font-weight: bold;
                margin-left: 2%;    /* margin B */
                margin-top: 4%;
                padding: 0.5em 1em;

                color: #48b8db;
            }


        </style>

    </head>
    <body>

    <script type="text/javascript">

        // 改进点
        // 1. 使用 position absolute 做 很耗内存, -webkit-transform 好一些

        // 元数据
        var data = [
            { img : "img_compress/f1@2x.png", caption : "草莓拿破仑", desc : "酥脆与柔软可以兼得", tags : ["高颜值下午茶", "入口即化"] },
            { img : "img_compress/f2@2x.png", caption : "水果冻膏", desc : "清凉一夏，就靠你了", tags : ["高颜值下午茶"] },
            { img : "img_compress/f3@2x.png", caption : "公主的仲夏夜之梦", desc : "穿好水晶鞋，一起来梦游仙境", tags : ["高颜值下午茶"] },
            { img : "img_compress/f4@2x.png", caption : "澳洲M2慢烤牛排", desc : "低温慢烤，牛排更加柔软多汁", tags : ["肉食主义"] },
            { img : "img_compress/f5@2x.png", caption : "泡芙塔巧克力蛋糕", desc : "泡芙留下，其余的都给你", tags : ["高颜值下午茶"] },
            { img : "img_compress/f6@2x.jpg", caption : "小笼包", desc : "等你来添加故事哟", tags : ["精选上海小吃"] },
            { img : "img_compress/f7@2x.jpg", caption : "培根火锅", desc : "等你来添加故事哟", tags : ["犒劳自己的晚餐"] },
            { img : "img_compress/f8@2x.jpg", caption : "摩卡", desc : "等你来添加故事哟", tags : ["高颜值下午茶"] },
            { img : "img_compress/f9@2x.jpg", caption : "酸奶慕斯", desc : "等你来添加故事哟", tags : ["高颜值下午茶"] }
        ];




        /****************************************** 1. 列表页 ******************************************/

        function Cards(args){
            this.wrap = args.dom || '';
            this.data = args.data || [];
            this.index = args.index || 0;
            this.SCALE = 0.94;
            this.cards = '';
            this.photos = '';

            // 构造N部曲
            this.renderCardListPage();
        }

        Cards.prototype.renderCardListPage = function () {
            // 构造N部曲
            this.init();
            this.renderDOM();
        //    |__ this.cards
        //    |__ this.photos
            this.adjustToScreenSize();
            this.zoomCards();
            this.sort();
            this.ifBackFromDetailPage();
            this.bindDOM();
        };

        Cards.prototype.init = function(){
            // 拿到屏幕的长和宽 有浏览器兼容问题
            this.screenHeight = (document.body.clientHeight === 0) ? document.documentElement.clientHeight : document.body.clientHeight;
            this.screenWidth = (document.body.clientWidth === 0) ? document.documentElement.clientWidth : document.body.clientWidth;
            // console.log(this.screenHeight, this.screenWidth);

            this.template = '<li class="stack_item next_item" id="card_{{index}}">\
                                <div class="picAndText">\
                                    <img class="photo" src="{{img}}" alt="food pics">\
                                    <h1>{{caption}}</h1>\
                                    <h2>{{desc}}</h2>\
                                </div>\
                                <div class="controls">\
                                    <div class="button_area button_dislike" data-stack="">\
                                        <img class="button_1" src="img_compress/dislike@2x.png" alt="dislike">\
                                    </div>\
                                    <div class="button_area button_like" data-stack="">\
                                        <img class="button_2" src="img_compress/like@2x.png" alt="like">\
                                    </div>\
                                </div>\
                            </li>';
        };

        Cards.prototype.renderDOM = function(){

            // 1. 如果没有wrap 就造一个
            if( this.wrap === '' ){
                var ulEle = document.createElement('ul');
                ulEle.id = 'container';
                // 插入body[0]
                document.body.insertBefore(ulEle,document.body.childNodes[0]);
                this.wrap = document.getElementById('container');
                //console.log(this.wrap);
            }

            // 看一下data是否为空
            // console.log(this.data.length);
            if( this.data.length === 0 ){
                this.wrap.innerHTML = "<h1>网络异常</h1>";
            }

            // 2. 数据填充内容模版
            var html = [];

            for(var i = 0 ; i < this.data.length; i++){
                var _html = this.template
                    .replace('{{index}}', i)
                    .replace('{{img}}', this.data[i].img)
                    .replace('{{caption}}', this.data[i].caption)
                    .replace('{{desc}}', this.data[i].desc);
                html.push(_html);
            }
            //console.log(html);
            // html内容重新插入
            this.wrap.innerHTML = html.join('');
            //console.log(html.join(''));
            //console.log(this.wrap.innerHTML);

            this.cards = document.querySelectorAll('.stack_item');
            this.photos = document.querySelectorAll('.photo');
            //console.log(this.wrap, document.querySelectorAll('.stack_item'), this.cards, this.photos);

        };

        Cards.prototype.adjustToScreenSize = function () {
            this.wrap.style.width = this.screenWidth + 'px';
            this.wrap.style.height = this.screenHeight + 'px';
            //console.log(this.wrap.style.width);
        };

        Cards.prototype.zoomCards = function () {

            var numOfCards = this.cards.length;
            var width = this.wrap.style.width;
            var height = this.wrap.style.height;
            //console.log( numOfCards );

            for(var i = 0; i < numOfCards; i++){
                // 缩小li0.94倍
                this.cards[i].style.width = parseInt(width.replace('px',''))*this.SCALE + 'px';
                this.cards[i].style.height = parseInt(height.replace('px',''))*this.SCALE + 'px';
                // 缩小img0.94倍
                this.photos[i].style.width = parseInt(width.replace('px',''))*this.SCALE + 'px';
                this.photos[i].style.height = parseInt(height.replace('px',''))*this.SCALE + 'px';
            }
        };

        Cards.prototype.sort = function () {
            // 把照片横向排列
            for(var i = 0 ; i < this.cards.length; i++){
                // 初始卡片位置，高度=屏幕高度，X = 0，1W，2W，3W ... Y = -1/3H
                this.cards[i].style.height = this.screenHeight;
                this.cards[i].style.top = -this.screenHeight/3 + 'px';
                this.cards[i].style.left = this.screenWidth*i + 'px';
                this.cards[i].style.display = "block";
            }
        };

        Cards.prototype.ifBackFromDetailPage = function () {

            // 对于要返回的这张区别对待
//            console.log(this.wrap);
//            console.log(this.index);
//            console.log(this.cards);
            var toBackPage = this.cards[this.index];
            console.log(toBackPage);
            // 赋予 .current_item 样式
            toBackPage.className = toBackPage.className.replace(/\s*next_item/,' current_item');
            // 赋予正常 Y 值
            toBackPage.style.top = '20px';
            // 赋予正常 X 值
            toBackPage.style.left = '0px';

            // 返回后的页面之前的卡片位置 X 重置
            for(var k = 0; k < this.index; k++){
                this.cards[k].className = this.cards[k].className.replace(/\s*next_item/,' prev_item');
                this.cards[k].style.left = this.screenWidth*(k-this.index) + 'px';
            }

            // 返回后的页面之后的卡片位置 X 重置
            for(var m = this.index; m < this.cards.length; m++){
                this.cards[m].style.left = this.screenWidth*(m-this.index) + 'px';
            }

            // 调试用
            for(var i = 0; i < this.cards.length; i++){
                console.log(this.cards[i].style.left);
            }
        };

        Cards.prototype.bindDOM = function(){
            // 点击事件会把this变换，所以用that先暂存this
            var that = this;

            var dislikeBtn = document.querySelectorAll('.button_1');
            //console.log(dislikeBtn);
            var likeBtn = document.querySelectorAll('.button_2');
            var picAndText = document.querySelectorAll('.picAndText');
            //console.log(picAndText);

            // 当点击的元素不是li, 向上冒泡直到li
            Cards.prototype.getLiEle = function(ele, eleName, eleId, eleIndex){
                while( true ){
                    // 如果是 li 结束
                    if( eleName === 'li' ){ break; }

                    // 向上冒泡，拿到爸爸元素
                    ele = ele.parentNode;
                    eleName = ele.localName;
                    eleId = ele.id;
                    eleIndex = parseInt(eleId.slice(5));
                    //console.log(ele, eleName, eleId, eleIndex);
                }
                return [ele, eleName, eleId, eleIndex];
            };

            Cards.prototype.getTheEndOfCardList = function(eleIndex, length){
                if( eleIndex === (length - 1) ) {
                    alert("到底啦～");
                }
            };

            /****************************************** 1. 喜欢 / 不喜欢事件 ******************************************/

            Cards.prototype.doDislikeAction = function(e) {

                // 1. 获取当前点击的元素,冒泡至li
                var ele = e.target;
                var eleName = ele.localName;
                var eleId = ele.id;
                var eleIndex = eleId.slice(5);
                var result = that.getLiEle(ele, eleName, eleId, eleIndex);
                for( var j = 0; j < result.length; j++ ){
                    ele = result[0];
                    eleName = result[1];
                    eleId = result[2];
                    eleIndex =result[3];
                }

                // 2. 如果到底了
                that.getTheEndOfCardList(eleIndex, that.data.length);

                // 4. 如果没到底，
                if( eleIndex < that.data.length - 1){

                    // 1. 当前的元素被点击后变成过去的元素
                    var chosenEle = document.getElementById(eleId);
                    chosenEle.className = chosenEle.className.replace(/\s*current_item/,' prev_item');
                    // 添加 .dislike样式
                    chosenEle.className += ' dislike';
                    // Y轴方向下移100像素
                    chosenEle.style.top = (parseInt(chosenEle.style.top) + 100) + 'px';

                    // 2. 下一个元素变成当前元素
                    var nextId = 'card_' + ( parseInt(eleIndex) + 1 );
                    var nextEle = document.getElementById(nextId);

                    nextEle.className = nextEle.className.replace(/\s*next_item/,' current_item');
                    // 调整下个元素的高度
                    nextEle.style.top = '20px';

                    // 3. 所有元素的位置调整
                    for(var i = 0; i < that.cards.length; i++){
                        that.cards[i].style.left = (parseInt(that.cards[i].style.left) - that.screenWidth) + 'px';
                        //console.log(cards[i].style.left);
                    }

                    // 4. btn变色
                    //console.log(document.querySelectorAll('.button_1')[eleIndex]);
                    var dislikeBtn = document.querySelectorAll('.button_1');
                    dislikeBtn[eleIndex].className += ' dislikeBtnPressed';
                }


            }

            Cards.prototype.doLikeAction = function(e) {

                // 1. 获取当前点击的元素
                var ele = e.target;
                var eleName = ele.localName;
                var eleId = ele.id;
                var eleIndex = eleId.slice(5);
                //console.log(ele, eleName, eleId, eleIndex);
                // 2. 当点击的元素不是li, 向上冒泡直到li
                var result = that.getLiEle(ele, eleName, eleId, eleIndex);
                for( var j = 0; j < result.length; j++ ){
                    ele = result[0];
                    eleName = result[1];
                    eleId = result[2];
                    eleIndex =result[3];
                }

                // 3. 如果到底了
                that.getTheEndOfCardList(eleIndex, that.data.length);

                // 4. 如果没到底，
                if( eleIndex < that.data.length - 1){

                    // 1. 当前的元素被点击后变成过去的元素
                    var chosenEle = document.getElementById(eleId);
                    chosenEle.className = chosenEle.className.replace(/\s*current_item/,' prev_item');
                    chosenEle.className += ' like';
                    // Y轴方向下移100像素
                    chosenEle.style.top = (parseInt(chosenEle.style.top) + 100) + 'px';

                    // 2. 下一个元素变成当前元素
                    var nextId = 'card_' + ( parseInt(eleIndex) + 1 );
                    var nextEle = document.getElementById(nextId);
                    nextEle.className = nextEle.className.replace(/\s*next_item/,' current_item');
                    // 调整下个元素的高度
                    nextEle.style.top = '20px';

                    // 3. 所有元素的位置调整
                    for(var i = 0; i < that.cards.length; i++){
                        if( i === eleIndex ){
                            that.cards[i].style.left = (parseInt(that.cards[i].style.left) + that.screenWidth) + 'px';
                        } else {
                            that.cards[i].style.left = (parseInt(that.cards[i].style.left) - that.screenWidth) + 'px';
                        }
                        //console.log(cards[i].style.left, cards[i].style.top);
                        //console.log(eleIndex, cards[i].style.left);
                    }
                    //console.log('\n');

                    // 4. btn变色
                    //console.log(document.querySelectorAll('.button_2')[eleIndex]);
                    document.querySelectorAll('.button_2')[eleIndex].className += ' likeBtnPressed';

                    function rePosition(){
                        for(var i = 0; i < that.cards.length; i++){
                            if( i === eleIndex ){
                                that.cards[i].style.left = -that.screenWidth + 'px';
                            } else if( i < eleIndex ) {
                                // 0  1  2  3  4  5
                                // 这段有点难算
                                that.cards[i].style.left = -(eleIndex-i+1)*that.screenWidth + 'px';
                            } else {
                                that.cards[i].style.left = (i-eleIndex-1)*that.screenWidth + 'px';
                            }
                            //console.log(cards[i].style.left, cards[i].style.top);
                            //console.log(eleIndex, cards[i].style.left);
                        }
                    }

                    function rePositionThen(callback){
                        if (typeof callback === "function"){
                            // 0.6秒后再回调
                            setTimeout(callback, 600);
                        }
                    }

                    // 动画完毕后，重新归位
                    rePositionThen(rePosition);
                }
            };

            /****************************************** 2. 去详情页 ******************************************/

            Cards.prototype.goToFoodDetailPage = function(e){
                //console.log("DetailPage");

                // 1. 获取当前点击的元素
                var ele = e.target;
                var eleName = ele.localName;
                var eleId = ele.id;
                var eleIndex = eleId.slice(5);
                //console.log(ele, eleName, eleId, eleIndex);

                // 2. 当点击的元素不是li, 向上冒泡直到li
                var result = that.getLiEle(ele, eleName, eleId, eleIndex);
                for( var j = 0; j < result.length; j++ ){
                    ele = result[0];
                    eleName = result[1];
                    eleId = result[2];
                    eleIndex =result[3];
                }

                // 存储下是第几个商品进入的详情页
                //localStorage.pageId = eleIndex;
                that.index = eleIndex;
                //console.log(localStorage.pageId);

                // 3. 清空所有列表页html ul#container
                //console.log(that.wrap);
                document.querySelector('body').removeChild(that.wrap);

                // 4. 创建详情页 div#detail
                var detailPage = document.querySelector('#detail') || '';

                if( detailPage === '' ){
                    var divEle = document.createElement('div');
                    divEle.id = 'detail';

                    document.body.insertBefore(divEle,document.body.childNodes[0]);
                    detailPage = document.getElementById('detail');
                }

                var template = '<div class="bigPhoto_area">\
                                    <img class="button_3" src="img_compress/back2@2x.png" alt="dislike">\
                                    <img class="bigPhoto" src="{{img}}" alt="big food pic">\
                                </div>\
                                <h1 class="detail_text">{{caption}}</h1>\
                                <h2 class="detail_text">{{desc}}</h2>\
                                <div class="tags_area"></div>\
                                <div class="controls">\
                                    <div class="button_area button_dislike">\
                                        <img class="button_1" src="img_compress/dislike@2x.png" alt="dislike">\
                                    </div>\
                                    <div class="button_area button_like">\
                                        <img class="button_2" src="img_compress/like@2x.png" alt="like">\
                                    </div>\
                                </div>';

                var html = [];
                //console.log(eleIndex);

                var _html = template
                    .replace('{{img}}', that.data[eleIndex].img)
                    .replace('{{caption}}', that.data[eleIndex].caption)
                    .replace('{{desc}}', that.data[eleIndex].desc);

                html.push(_html);
                detailPage.innerHTML = html;

                // 初始化位置后才可以利用位置值移动 CSS 没做到 没有这3个值，后面的动画无法完成位移
                detailPage.style.position = 'absolute';
                detailPage.style.left = '0px';
                detailPage.style.top = '0px';
                // 给内页一个高度
                detailPage.style.height = that.screenHeight + 'px';
                //console.log(detailPage.style.height);
                // 把隐藏的这段html变为可视
                detailPage.style.display = "block";
                detailPage.style['-webkit-transition'] = 'all .6s linear';

                // 标签内容显示
                var tags = document.querySelector('.tags_area');
                for(var i = 0; i < that.data[eleIndex]['tags'].length; i++){
                    var spanEle = document.createElement('span');
                    spanEle.textContent += that.data[eleIndex]['tags'][i];
                    spanEle.className += 'tags';
                    tags.appendChild(spanEle);
                }


                // 返回按钮与事件绑定
                var backBtn = document.querySelector('.button_3');
                //console.log(backBtn);

                // 喜欢与不喜欢按钮与事件绑定
                var dislikeBtn = document.querySelector('.button_1');
                var likeBtn = document.querySelector('.button_2');
                //console.log(dislikeBtn);

                backBtn.onclick = that.goBackToFoodCards;

                dislikeBtn.onclick = that.doDislikeActionOnDetailPage;
                likeBtn.onclick = that.doLikeActionOnDetailPage;

            };

            /****************************************** 3. 从详情页回到列表页 ******************************************/

            Cards.prototype.goBackToFoodCards = function(e){

                // 1. 清空详情页
                var cardDetail = document.querySelector('#detail');
                document.querySelector('body').removeChild(cardDetail);

                // 2. 加载列表页
                new Cards({
                    'dom'  : document.getElementById('container') || '',
                    'data' : data,
                    'index': that.index
                });
            };

            // 在父级元素上添加点击事件 ** 未来可以把按钮提出来，减少事件绑定 **
            for(var j = 0; j < dislikeBtn.length; j++){
                dislikeBtn[j].onclick = that.doDislikeAction;
                likeBtn[j].onclick = that.doLikeAction;
                picAndText[j].onclick = that.goToFoodDetailPage;
                //console.log(dislikeBtn[j]);
                //console.log(picAndText[j]);
            }
            //console.log(this);

            /****************************************** 4. 详情页的3个事件 ******************************************/

            Cards.prototype.doLikeActionOnDetailPage = function(e) {

                // 1. 是从序号多少的食物点进来的
                var eleIndex = that.index;
                //console.log(eleIndex);

                // 2. 如果到底了
                that.getTheEndOfCardList(eleIndex, that.data.length);

                // 3. 如果没到底
                // 先做 like 的动画
                if( eleIndex < that.data.length - 1) {

                    // 选中整个详情页
                    var chosenEle = document.getElementById('detail');
                    //console.log(chosenEle);
                    //chosenEle.style.display = "none";

                    function animate(){

                        // 添加 .like .prev_item 样式
                        chosenEle.className += ' like';
                        chosenEle.className += ' prev_item';
                        //console.log(chosenEle.className);

                        // btn变色
                        //console.log(document.querySelectorAll('.button_1')[eleIndex]);
                        document.querySelector('.button_2').className += ' likeBtnPressed';

                        // 向左移动一个屏幕 前提依赖是设置了 position: absolute, top, left等值
                        //console.log(chosenEle.style.left);
                        chosenEle.style.left = (parseInt(chosenEle.style.left) + that.screenWidth) + 'px';
                        //console.log(chosenEle.style.left);

                        // Y轴方向下移100像素
                        chosenEle.style.top = (parseInt(chosenEle.style.top) + 100) + 'px';
                        //console.log(chosenEle.style.left, chosenEle.style.top);

                    }

                    function animateThen(callback){

                        if (typeof callback === "function"){
                            // 0.6秒后再回到列表页
                            setTimeout(callback, 600);
                        }
                    }

                    // 动画结束后回到列表页
                    animate();
                    // 4. 回到上一页
                    animateThen(that.goBackToNextFoodCards);

                }

            };

            Cards.prototype.doDislikeActionOnDetailPage = function(e) {

                // 1. 是从序号多少的食物点进来的
                var eleIndex = that.index;
                //console.log(eleIndex);

                // 2. 如果到底了
                that.getTheEndOfCardList(eleIndex, that.data.length);

                // 3. 如果没到底
                // 先做 dislike 的动画
                if( eleIndex < that.data.length - 1) {

                    // 选中整个详情页
                    var chosenEle = document.getElementById('detail');
                    //console.log(chosenEle);
                    //chosenEle.style.display = "none";

                    function animate(){

                        // 添加 .dislike样式
                        chosenEle.className += ' dislike';
                        chosenEle.className += ' prev_item';
                        //console.log(chosenEle.className);

                        // btn变色
                        //console.log(document.querySelectorAll('.button_1')[eleIndex]);
                        document.querySelector('.button_1').className += ' dislikeBtnPressed';

                        // Y轴方向下移100像素
                        chosenEle.style.top = (parseInt(chosenEle.style.top) + 100) + 'px';
                        //console.log(chosenEle.style.top);

                        // 向左移动一个屏幕 不知道为何失效
                        //console.log(chosenEle.style.left);
                        chosenEle.style.left = (parseInt(chosenEle.style.left) - that.screenWidth) + 'px';
                        //console.log(chosenEle.style.left);

                    }


                    function animateThen(callback){

                        if (typeof callback === "function"){
                            // 0.6秒后再回到列表页
                            setTimeout(callback, 600);
                        }
                    }

                    // 动画结束后回到列表页
                    animate();

                    // 4. 回到上一页
                    animateThen(that.goBackToNextFoodCards);

                }

            };

             Cards.prototype.goBackToNextFoodCards = function(e){

                // 清空本页
                var cardDetail = document.querySelector('#detail');
                document.querySelector('body').removeChild(cardDetail);

                // 加载列表页下一张
                new Cards({
                    'dom'  : document.getElementById('container') || '',
                    'data' : data,
                    'index': that.index + 1
                });
            };
        };

        new Cards({
            'dom'  : document.getElementById('container') || '',
            'data' : data,
            'index': 0
        });

    </script>

    </body>
</html>